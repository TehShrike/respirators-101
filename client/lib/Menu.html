
<ul class="links">
	{{#each navigation as item}}

	<li class="{{ item.id }}">
	
		{{#if item.children}}
			
		<Category :asr :item :closeAllExpands :registerExpand>
			<ul>
				{{#each item.children as page}}
				<li class="{{ page.id }}">
					<a href="{{ asr.makePath('wrapper.app.categorycontent', { id: page.id, catid: item.id }) }}">{{page.title}}</a>
				</li>
				{{/each}}
			</ul> 
		</Category>

		{{elseif item.state}}

		<a href="{{ asr.makePath( item.state ) }}">{{item.title}}</a>

		{{elseif item.id}}

		<a href="{{ asr.makePath('wrapper.app.content', { id: item.id }) }}">{{item.title}}</a>

		{{/if}}

	</li>

	{{/each}}
</ul>

<script>

	import Category from 'lib/Category.html'

	import menu from 'data/menu.json'
	import posts from 'data/posts.json'
	import categories from 'data/categories.json'

	const navigation = menu.map(e => {

		const id = e.name

		if(e.type == 'category') {
			return {
				id,
				title: categories[id].title,
				children: categories[id].children.map(id => ({
					id,
					title: posts[id]
				}))
			}
		} else {
			return {
				id,
				title: posts[id]
			}
		}
	})

	// insert custom links
	navigation.splice(0, 0, {
		id: 'home',
		title: 'Home',
		state: 'wrapper.home'
	})
	navigation.splice(2, 0, {
		id: 'respirator-picker',
		title: 'Respirator Selection Tool',
		state: 'wrapper.app.respirator-picker'
	})
	navigation.splice(4, 0, {
		id: 'my-info',
		title: 'My Info'
	})
	navigation.splice(5, 0, {
		id: 'chemical-lookup',
		title: 'Chemical Lookup'
	})
	navigation.splice(6, 0, {
		id: 'calculate',
		title: 'Calculate'
	})
	navigation.splice(12, 0, {
		id: 'copyright-statement',
		title: 'Copyright Statement'
	})


	export default {
		components: {
			Category
		},
		oncreate() {

			document.querySelectorAll('.expand').forEach(e => {
				e.style.height = e.clientHeight + 'px'
				e.setAttribute('class', 'expand initialized')
			})

		},
		// until https://github.com/sveltejs/svelte/issues/881 lands, this is the best way to do dynamic refs that I can think of
		data() {
			var expands = []
			return { 
				navigation,
				closeAllExpands() {
					expands.forEach(e => {
						e._set({ open: false })
					})
				},
				registerExpand(expand) {
					expands.push(expand)
				}
			}
		}
	}

</script>

<style>

	@import "colors";

	ul, li {
		list-style: none;
		display: block;
		padding: 0;
		margin: 0;
	}

	a {
		color: #fff;
		display: block;
		line-height: 20px;
		text-decoration: none;
		padding: 15px 20px;
		border-top: 1px solid $blue2;
		background: $blue3;
		border-bottom: 1px solid $blue4;

		&:hover {
			background: $blue4;
		}
	}

	.expand a {
		border: 0;
		background: $blue2;
	}

	.category-title {
		position:relative;

		.chevron {
			display: block;
			position:absolute;
			top: 0; 
			right:0;
			width: 50px;
			height: 50px;
			font-size: 28px;
			line-height: 50px;
			text-align: center;
			transition: transform .2s ease-out;
			transform: rotate(270deg);
		}

		.chevron::before {
			margin-left: -2px;
		}
	}

	.category[data-open=true] .chevron {
		transform: rotate(90deg);
	}

	li.getting-started, li.respirator-picker, li.all-about-respirators {
		a {
			border-top: 1px solid $yellow2;
			background: $yellow3;
			border-bottom: 1px solid $yellow4;
			&:hover {
				background: $yellow4;
			}
		}

		.expand a {
			border: 0;
			background: $yellow2;
		}
	} 

	li.my-info, li.chemical-lookup, li.calculate, li.conversion-tables, li.osha-standards, li.acronyms, li.glossary, li.resources {
		a {
			border-top: 1px solid $red2;
			background: $red3;
			border-bottom: 1px solid $red4;
			&:hover {
				background: $red4;
			}
		}

		.expand a {
			border: 0;
			background: $red2;
		}
	} 


</style>